# Epic 12: 语音消息能力

> Status: Draft
> Owner: 
> Priority: High

## 1. 背景与目标
为了增强 WeAgentChat 的拟人化社交体验，我们需要让 AI 好友具备语音交流的能力。不仅仅是文字回复，更能通过生动的语音与用户互动，模拟真实的微信语音消息体验。
本 Epic 旨在引入阿里云百炼的 TTS（语音合成）能力，支持 AI 好友发送语音消息。

## 2. 核心功能
1.  **音色库管理**：系统内置丰富的音色供用户选择，支持预览。
2.  **语音设置**：全局配置 TTS 服务商（阿里云百炼）及 API Key。
3.  **好友语音配置**：为每个 AI 好友单独开启/关闭语音回复，并指定专属音色。
4.  **语音消息交互**：
    -   AI 回复时并行生成语音。
    -   前端展示仿微信语音条。
    -   支持点击播放、自动连续播放未读语音。

## 3. 用户故事 (Stories)

| ID | 标题 | 简述 |
| :--- | :--- | :--- |
| Story 12-1 | 语音音色库与数据库设计 | 解析音色文档，建立音色数据表，提供查询接口。 |
| Story 12-2 | 全局语音设置界面 | 在设置中增加语音配置 Tab，支持 API Key 校验和试听。 |
| Story 12-3 | 好友语音个性化配置 | 编辑好友弹窗支持开启语音回复及选择音色。 |
| Story 12-4 | 语音消息生成与播放体验 | 消息分段并行 TTS，前端仿微信 UI 及自动连播逻辑。 |

## 4. 技术依赖
-   服务商：阿里云百炼 (DashScope)
-   模型：qwen3-tts-instruct-flash (主要)
-   输入格式：文本
-   输出格式：Audio URL / Blob (MP3/WAV)

## 5. 验收标准
-   用户可以成功配置阿里云 API Key 并测试通过。
-   用户可以在好友设置中预览并选择不同音色。
-   开启语音后，AI 好友的回复以语音条形式展示。
-   即时响应：AI 思考完成后，语音消息应尽快开始播放（并行处理）。
-   交互流畅：支持点击播放、暂停，且多条语音能自动连续播放。
