# Epic 10 交互方案固定版 - 群聊自驱模式（头脑风暴 / 决策 / 辩论）

> **文档说明**：本方案用于固定“群聊自驱模式”的交互设计与规则定义，不涉及代码实现。以现有 `GroupChatArea.vue` 为主界面承载。

## 1. 目标与范围

### 1.1 目标
- 群聊引入“自驱多轮对话”，用户只需一次触发即可连续对话。
- 支持三种模式：**头脑风暴**、**决策** 与 **辩论**。
- 用户始终可插话；模式运行清晰可见、可暂停/继续。
- 技术上采用 **Hybrid**：体验层合并在群聊，逻辑层独立编排。

### 1.2 范围
- 仅定义 UI/交互/规则与状态流程。
- 不涉及 API、数据结构或代码实现细节。
 - 重点约束：自驱逻辑在后端与普通群聊解耦（独立编排与状态），避免相互污染。

---

## 2. 极简模板（已确认）

仅保留 5 个核心字段：
1. `mode`：头脑风暴 / 决策 / 辩论  
2. `topic`：题目（按模式不同而不同，见第 4 节）  
3. `roles`：参与角色（头脑风暴/决策为成员列表；辩论为正/反方 1~2 人）  
4. `turn_limit`：发言上限  
5. `end_action`：总结 / 胜负判定 / 两者  

> 默认规则：用户任何时刻可插话（不作为字段）。
> 轮次口径：头脑风暴/决策为“每位成员发言一次=1轮”；辩论为“正反双方各完成一次发言=1轮”。

---

## 3. 入口设计（仅一个入口）

**位置**：`GroupChatArea` 输入区工具栏（Emoji 与“新会话”旁）。  
**形态**：按钮「自驱」。  
- 未运行：点击弹出“模式配置”。  
- 运行中：点击弹出“运行面板”（含暂停/继续/终止）。

---

## 4. 配置弹窗（极简 + 模式特化）

### 4.1 公共字段
- 模式：头脑风暴 / 决策 / 辩论  
- 题目（按模式不同而不同）  
- 参与成员  
- 发言上限  
- 结束动作（总结 / 胜负判定 / 两者）
> 运行中配置不可修改，只能结束后重新配置。

### 4.2 头脑风暴模式题目字段（必须填）
- **主题**：[主题陈述]  
- **目标**：[期望产出/范围]  
- **约束**：[限制条件，如时间/成本/受众]  

### 4.3 决策模式题目字段（必须填）
- **决策问题**：[需要做出的选择]  
- **候选方案**：[可多行录入]  
- **评估标准**：[权重/优先级或关键指标]  

### 4.4 辩论特化字段
辩论模式题目分为三项（必须填）：
- **辩题**：[主题陈述]  
- **正方**：[具体立场]  
- **反方**：[具体立场]  

### 4.5 角色限制
辩论模式：  
**正方 1~2 人、反方 1~2 人**，超过 2 人禁止，且**正反人数必须相等**。  

### 4.6 裁判 / 总结角色
可选择“用户自己”（默认）或指定成员。  

---

## 5. 运行态展示（固定在消息列表上方）

**状态条（类群公告）**：
- 左侧：模式标签 + 题目  
- 中间：阶段 + 进度（例：自由交锋 3/12）  
- 右侧：暂停 / 继续 + 终止  
- 次行提示：下一位发言者（例：下一位：正方A）

---

## 6. 消息展示规则（单气泡）

自驱模式下：  
**每次发言只显示一个气泡**，不再按 `<message>` 分段拆成多个气泡。  
目的：保证阅读连贯与理解成本可控。

---

## 7. 辩论模式规则（固定流程）

### 基本设置
- 每场辩论：正方 vs 反方  
- 每队人数：1~2 人  
- 辩论模式：异步发言（适合群聊节奏）
- 轮次统计：**正反双方分别发言完一次计为 1 轮**  
- 发言顺序：**正方先发言**  
- 一辩指派：按成员 `member_id` 的 **ASCII 升序**排序，正方先于反方  

### 阶段一：立论陈述
1. 正方一辩：陈述核心观点  
2. 反方一辩：陈述核心观点  

### 阶段二：自由交锋（对应 `turn_limit`）
- 顺序固定：  
  **正方A → 反方A → 正方B → 反方B → 正方A → 反方A...**  
- 每人每次 **≤ 200 字**  
- 可提问 / 反驳 / 举例  
> 字数限制为 **软限制**，写入 Prompt 约束即可，不做硬截断。

### 阶段三：总结陈词
1. 反方总结  
2. 正方总结  
3. 评委宣判胜负（默认用户）

---

## 8. 头脑风暴 / 决策模式规则

### 8.1 调度规则
- 由**群管理员调度**决定发言人  
- 轮次统计：**每位成员发言一次计为 1 轮**  

### 8.2 头脑风暴产出
- 输出：**创意清单 + 归类/合并 + Top 结论**  

### 8.3 决策模式产出
- 输出：**方案对比 + 推荐方案 + 风险与下一步**  

---

## 9. 正反方标识（辩论模式 UI）

**头像标识**：
- 正方：绿色「正」角标  
- 反方：红色「反」角标  

**昵称标识**：
昵称旁追加小标签（正方 / 反方）。

---

## 10. 暂停与插话规则（明确）

### 10.1 暂停定义
- “暂停”是**调度暂停**，即不再启动下一位发言者。  
- 若当前已有 AI 正在生成：进入“等待收尾”状态，等当前生成结束后进入“暂停中”。  

### 10.2 暂停时的编辑与插话
- 暂停状态下输入框可用，用户可随时插话。  
- 插话**不触发新的 AI 回复**，仅记录为最新上下文。  
- 插话期间若 **@ 指定成员**，被 @ 成员**立即回复**。  
- 用户点击“继续”后，继续之前的辩论/头脑风暴/决策顺序（顺序不变），插话纳入上下文。  

---

## 11. 运行流程（状态流）

1. **Idle**：未启动  
2. **Running**：按模式自动发言  
3. **Pausing**：等待当前发言结束  
4. **Paused**：暂停中，可插话  
5. **Ended**：达到终止条件，生成总结/判定  

---

## 12. 验收要点（交互层）

- 仅有一个入口（工具栏自驱按钮）。  
- 辩论模式强制填写辩题/正方/反方，正反人数 1~2 且必须相等。  
- 辩论模式头像与昵称有正/反标识。  
- 运行态状态条显示在消息列表上方。  
- 自驱模式发言不拆分多个气泡（单 message 标签）。  
- 暂停时可插话，插话不打断当前输出。  
- 辩论流程严格遵守三阶段与固定顺序。  
- 运行中配置不可修改。  
